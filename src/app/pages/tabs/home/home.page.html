<!-- <ion-content [fullscreen]="true" class="page-content tab-page-white"> -->
<ion-content
  [fullscreen]="true"
  class="page-content"
  [ngClass]="activeSegment === 'investments' ? investment?.user_details.subscriber.subscription.length > 0 ? 'investments' : 'investments no-trans' : ''"
>
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="main-header">
    <div class="header-name">
      <div class="img-wrapper">
        <!-- <img src="" alt=""> -->
        <div class="default-img">MT</div>
      </div>
      <div class="name">
        <h3>Hi {{ user?.fullname.split(' ')[0] }},</h3>
        <p>Hope you're having a great {{ getTimeOfDay()}}.</p>
      </div>
    </div>

    <div class="rate">{{home? home.daily_rate : '-----' }}</div>

    <!-- <ion-icon src="assets/icon/chat.svg"></ion-icon> -->
  </div>

  <ion-segment value="wallet" (ionChange)="segmentChanged($event)" mode="md">
    <ion-segment-button value="wallet" mode="md">
      <ion-label>Wallet</ion-label>
    </ion-segment-button>
    <ion-segment-button value="investments">
      <ion-label>Investments</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- Wallet Segment... -->
  <div *ngIf="activeSegment === 'wallet'" class="segment segment-wallet">
    <div class="summary">
      <div class="summary-header">
        <div class="balance">
          <p>Wallet Balance</p>
          <h2 [ngClass]="!showBalance ? 'blur-text' : 'show-text'">${{util.numberWithCommas(wallet?.balance)}}</h2>
        </div>
        <div class="hidden-wrapper">
          <ion-icon
            [src]="'assets/icon/'+balanceIcon+'.svg'"
            (click)="hideShowBalance()"
          ></ion-icon>
        </div>
      </div>

      <ion-row>
        <ion-col>
          <div class="cta">
            <ion-icon src="assets/icon/v2-icons/deposit.svg"></ion-icon>
            <p>Deposit</p>
          </div>
        </ion-col>
        <ion-col>
          <div class="cta">
            <ion-icon src="assets/icon/v2-icons/withdraw.svg"></ion-icon>
            <p>Withdraw</p>
          </div>
        </ion-col>
        <ion-col>
          <div class="cta" (click)="openTransferModal()">
            <ion-icon src="assets/icon/v2-icons/transfer.svg"></ion-icon>
            <p>Transfer</p>
          </div>
        </ion-col>
      </ion-row>
    </div>

    <div class="quick-trans">
      <p class="section-title">Quick Transfer</p>

      <ion-row class="quick-transfer-wrapper">
        <ion-col size="3">
          <ion-icon
            class="add-quick"
            src="assets/icon/v2-icons/quick-add.svg"
          ></ion-icon>
        </ion-col>

        <ion-col size="4" *ngFor="let quick of wallet?.quick_transfers">
          <div class="quick-transfer-item" (click)="goToTransferUserPage(true, 'email')">
            <div class="default-img">{{quick.fullname.split(' ')[0][0]}}{{quick.fullname.split(' ')[1][0]}}</div>
            <p>{{quick.fullname.split(' ')[0]}}</p>
          </div>
        </ion-col>
        <ion-col size="4">
          <div class="quick-transfer-item" (click)="goToTransferUserPage(true)">
            <div class="default-img">JM</div>
            <p>Janada</p>
          </div>
        </ion-col>
        <ion-col size="4">
          <div class="quick-transfer-item" (click)="goToTransferUserPage(true)">
            <div class="default-img">IU</div>
            <p>Ibrahim</p>
          </div>
        </ion-col>
        <ion-col size="4">
          <div class="quick-transfer-item" (click)="goToTransferUserPage(true)">
            <div class="default-img">AA</div>
            <p>Aisha</p>
          </div>
        </ion-col>

        <!-- <ion-col
          size="6"
          *ngFor="let inv of home?.user_details.subscriber.subscription"
          [ngClass]="{'alter-margin': home?.user_details.subscriber.subscription.length === 1}"
        >
          <div class="investment-item" (click)="goToInvestmentDeets(inv)">
            <p>Balance</p>
            <h4>
              <span *ngIf="showBalance"
                >${{ util.numberWithCommas(addInvBalances(inv)) }}</span
              ><span *ngIf="!showBalance" class="hidden">******</span>
            </h4>
            <div
              class="type-area {{ getIconForInvName(inv.subscription.name) || 'levadura-big' }}"
            >
              <ion-icon
                [src]="'assets/icon/inv-type/'+ (getIconForInvName(inv.subscription.name) || 'special-big') +'.svg'"
              ></ion-icon>
              <h4>
                {{ inv.subscription.name.substring(0,8)
                }}{{inv.subscription.name.length > 8 ? '...': ''}}
              </h4>
            </div>
          </div>
        </ion-col> -->
      </ion-row>
    </div>

    <div class="recent-trans">
      <p class="section-title">Recent Wallet Transactions</p>
      <p class="section-title">
        View all
        <ion-icon src="assets/icon/v2-icons/forward-green.svg"></ion-icon>
      </p>
    </div>

    <div class="transactions-list">
      <div class="transaction" (click)="openInfoModal(trans.type.toLowerCase(), trans)" *ngFor="let trans of wallet?.latest_wallet_transactions | slice:0:5">
        <div class="trans-type-wrapper">
          <ion-icon src="assets/icon/v2-icons/trans-deposit.svg"></ion-icon>
          <div class="trans-type">
            <h3>{{trans.type}}</h3>
            <p class="trans-type-p">Bank Transfer</p>
          </div>
        </div>
        <div class="amount-date">
          <div
            class="amount"
            [ngClass]="!showBalance ? 'hide-text' : 'reveal-text'"
          >
            +${{util.numberWithCommas(trans.amount)}}
          </div>
          <div class="trans-date">{{trans.created_at | date }}</div>
        </div>
      </div>
      <!-- <div class="transaction">
        <div class="trans-type-wrapper">
          <ion-icon src="assets/icon/v2-icons/trans-bonus.svg"></ion-icon>
          <div class="trans-type">
            <h3>Bonus</h3>
            <p class="trans-type-p">Referral Bonus</p>
          </div>
        </div>
        <div class="amount-date">
          <div
            class="amount"
            [ngClass]="!showBalance ? 'hide-text' : 'reveal-text'"
          >
            +$3,403.58
          </div>
          <div class="trans-date">16 June 2023</div>
        </div>
      </div>
      <div class="transaction">
        <div class="trans-type-wrapper">
          <ion-icon src="assets/icon/v2-icons/trans-withdraw.svg"></ion-icon>
          <div class="trans-type">
            <h3>Withdrawal</h3>
            <p class="trans-type-p">To Bank Account</p>
          </div>
        </div>
        <div class="amount-date">
          <div
            class="amount"
            [ngClass]="!showBalance ? 'hide-text' : 'reveal-text'"
          >
            +$3,403.58
          </div>
          <div class="trans-date">16 June 2023</div>
        </div>
      </div> -->
    </div>

    <!-- <div class="no-transactions">
      <img src="assets/imgs/cacti.svg" />
      <p>It's a bit empty here because you haven't made any transaction yet.</p>
      <div class="quick-btn-round">Deposit Now</div>
    </div> -->

    <!-- <div class="finish-kyc">
      <div
        class="progress"
        [style]="'background: radial-gradient(closest-side, white 79%, transparent 80% 100%), conic-gradient(var(--ion-color-primary) '+ percent +'%, rgba(var(--ion-color-secondary-rgb), 0.2) 0)'"
      >
        {{percent}}%
      </div>
      <div class="text">
        <p>Finish setting up your account</p>
        <p>Complete your KYC to get full access to Kwakol Funds</p>
      </div>
    </div> -->
  </div>
  <!-- End Wallet Segment -->

  <!-- Investments Segment... -->
  <div
    *ngIf="activeSegment === 'investments'"
    class="segment segment-investments"
  >
    <div class="segment-head">
      <div class="quick-summary">
        <p class="title">
          Total Investments
          <ion-icon
            [src]="'assets/icon/v2-icons/'+balanceIcon+'-green.svg'"
            (click)="hideShowBalance()"
          ></ion-icon>
        </p>

        <h3 [ngClass]="!showBalance ? 'blur-text green' : 'show-text'">
          ${{ homeBalance }}
        </h3>

        <div class="cta-wrapper">
          <div class="cta">
            <div class="btn">
              <ion-icon src="assets/icon/v2-icons/cta-deposit.svg" (click)="goToPage('/deposit')"></ion-icon>
            </div>
            <p>Deposit</p>
          </div>
          <div class="cta">
            <div class="btn">
              <ion-icon src="assets/icon/v2-icons/cta-withdraw.svg" (click)="goToPage('/withdrawal')"></ion-icon>
            </div>
            <p>Withdraw</p>
          </div>
          <div class="cta">
            <div class="btn">
              <ion-icon src="assets/icon/v2-icons/cta-more.svg"></ion-icon>
            </div>
            <p>More</p>
          </div>
        </div>
      </div>

      <ion-row class="investments-wrapper" *ngIf="investment?.user_details.subscriber.subscription.length > 0">
        <ion-col size="2">
          <div class="add-investment-wrapper">
            <div class="add-investment" (click)="goToNewAccount()">
              <ion-icon src="assets/icon/v2-icons/add-green.svg"></ion-icon>
            </div>
          </div>
        </ion-col>

        <ion-col
          size="5"
          *ngFor="let inv of investment?.user_details.subscriber.subscription"
          [ngClass]="{'alter-margin': investment?.user_details.subscriber.subscription.length === 1}"
        >
          <div class="investment-item" (click)="goToInvestmentDeets(inv)">
            <div
              class="type-area {{ getIconForInvName(inv.subscription.name) || 'levadura-big' }}"
            >
              <div class="icon-wrapper">
                <ion-icon
                  [src]="'assets/icon/inv-type/'+ (getIconForInvName(inv.subscription.name) || 'special-big') +'.svg'"
                ></ion-icon>
              </div>
              <h4>
                <span>The Plan</span><br />
                <span>
                  {{ inv.subscription.name.substring(0,8)
                  }}{{inv.subscription.name.length > 8 ? '...': ''}}
                </span>
              </h4>
            </div>
            <p>Balance</p>
            <h4>
              <span
                class="balance"
                [ngClass]="!showBalance ? 'blur-text green' : 'show-text regular'"
                >${{ util.numberWithCommas(addInvBalances(inv)) }}</span
              >
              <!-- <span *ngIf="!showBalance" class="hidden">******</span> -->
            </h4>
          </div>
        </ion-col>

        <ion-col size="5" *ngIf="!home" class="inv-skeleton">
          <ion-item>
            <ion-thumbnail slot="start">
              <ion-skeleton-text animated></ion-skeleton-text>
            </ion-thumbnail>
          </ion-item>
        </ion-col>

        <ion-col size="6" *ngIf="!home" class="inv-skeleton">
          <ion-item>
            <ion-thumbnail slot="start">
              <ion-skeleton-text animated></ion-skeleton-text>
            </ion-thumbnail>
          </ion-item>
        </ion-col>

        <!-- <ion-col size="6">
          <div class="investment-item">
            <p>Balance</p>
            <h4>$7,534.59</h4>
            <div class="type-area marigold-big">
              <ion-icon src="assets/icon/inv-type/marigold.svg"></ion-icon>
              <h4>Marigold</h4>
            </div>
          </div>
        </ion-col>
        <ion-col size="6">
          <div class="investment-item">
            <p>Balance</p>
            <h4>$1,255.49</h4>
            <div class="type-area levadura-big">
              <ion-icon src="assets/icon/inv-type/levadura.svg"></ion-icon>
              <h4>Levadura</h4>
            </div>
          </div>
        </ion-col> -->
      </ion-row>
    </div>

    <div class="list-wrapper">

      <div class="recent-trans investments">
        <p class="section-title">Transaction History</p>
        <p class="section-title">
          View all
          <ion-icon src="assets/icon/v2-icons/forward-green.svg"></ion-icon>
        </p>
      </div>

      <div class="transactions-list no-border" *ngIf="homeHistories.length > 0">
        <div class="transaction" *ngFor="let hist of homeHistories | slice:0:4">
          <div class="trans-type-wrapper">
            <ion-icon
              [src]="'assets/icon/v2-icons/'+getIconForType(hist.type)+'.svg'"
            ></ion-icon>
            <div class="trans-type">
              <h3>
                {{ hist.type | capitalize }}
              </h3>
              <p class="trans-type-p">{{hist.comment}}</p>
            </div>
          </div>
          <div class="amount-date">
            <div
              class="amount"
              [ngClass]="!showBalance ? 'hide-text' : 'reveal-text'"
            >
            ${{ util.numberWithCommas(hist.amount) }}
            </div>
            <div class="trans-date">{{ hist.date }}</div>
          </div>
          <!-- <p (click)="goToHistorySummary(hist)">
            {{ hist.date }}<span *ngIf="hist.type === 'profit'"
              >{{ hist.percentage || 0}}%</span
            >
          </p> -->
        </div>
      </div>

      <div class="no-transactions no-border" *ngIf="homeHistories.length === 0">
        <img src="assets/imgs/cacti.svg" />
        <p>It's a bit empty here because you haven't made any transaction yet.</p>
        <div class="quick-btn-round">Deposit Now</div>
      </div>

      <!-- <p
        class="no-histories"
        *ngIf="investment && investment?.user_details.transactions <= 0"
      >
        No history available...
      </p> -->

      <div class="tt-skeletons" *ngIf="!home">
        <ion-item *ngFor="let f of [1,2,3,4]">
          <ion-avatar slot="start">
            <ion-skeleton-text animated></ion-skeleton-text>
          </ion-avatar>
          <ion-label>
            <h3>
              <ion-skeleton-text
                class="left"
                animated
                style="width: 25%"
              ></ion-skeleton-text>
              <ion-skeleton-text
                class="right"
                animated
                style="width: 15%"
              ></ion-skeleton-text>
            </h3>
          </ion-label>
        </ion-item>
      </div>
    </div>
  </div>




  <!-- MODALS FOR WALLET SECTION -->

  <!-- Make transfer modal -->
  <ion-modal
    #transferModal
    trigger="open-transfer-drawer"
    [initialBreakpoint]="0.40"
    [breakpoints]="[0, 0.40]"
    class="kwakol-modal-bottom-drawer2"
    handle="true"
  >
    <ng-template>
      <ion-content>
    
        <!-- <div class="round-button">
          <ion-icon src="assets/icon/padlock.svg"></ion-icon>
        </div> -->
        <h3>Where would you like to transfer to?</h3>
        <!-- <p class="p1">Enter your pin to log in</p> -->

        <div class="content-wrapper">
          <div class="item" (click)="openTransferUserModal()">
            <div class="round-button">
              <ion-icon src="assets/icon/v2-icons/round-btns/user.svg"></ion-icon>
            </div>
            <p>User</p>
          </div>
          <div class="item">
            <div class="round-button">
              <ion-icon src="assets/icon/v2-icons/round-btns/investment.svg"></ion-icon>
            </div>
            <p>Investment</p>
          </div>
          <div class="item">
            <div class="round-button">
              <ion-icon src="assets/icon/v2-icons/round-btns/beneficiary.svg"></ion-icon>
            </div>
            <p>Beneficiary</p>
          </div>
        </div>

        <!-- <div class="pin-wrapper">
          <ion-input
            [type]="inputPinTypePassword ? 'password' : 'text'"
            name="password"
            [maxlength]="4"
            [(ngModel)]="pin"
            disabled
            (click)="onTapPinInput()"
            [ngStyle]="{fontSize: inputPinTypePassword ? '5rem' : '1.5rem', color: inputPinTypePassword ? 'rgba(81, 175, 78, 0.2)' : '#211F42'}"
          ></ion-input>
        </div> -->
        
        <!-- <ion-row class="btn-row">
          <ion-col size="10" class="ion-text-center btn-col">
            <ion-button
              class="kwakol-btn ion-text-uppercase"
              type="submit"
              (click)="loginWithPin()"
              >Log in</ion-button
            >
          </ion-col>
        </ion-row> -->
      </ion-content>
    </ng-template>
  </ion-modal>
  <!-- Transfer Modal -->

  <!-- Transfer to User Modal -->
  <ion-modal
    #transferUserModal
    trigger="open-transfer-user-drawer"
    [initialBreakpoint]="0.75"
    [breakpoints]="[0, 0.40, 0.55, 0.75]"
    class="kwakol-modal-bottom-drawer2 transfer-user"
    handle="true"
  >
    <ng-template>
      <ion-content>
    
        <div class="round-button center">
          <ion-icon src="assets/icon/v2-icons/round-btns/user.svg"></ion-icon>
        </div>

        <h3 class="ion-text-center">Transfer to User</h3>
        <!-- <p class="p1">Enter your pin to log in</p> -->
        
        <div class="input-wrapper">
          <label for="input-field">To:</label>
          <input type="text" id="input-field" name="input-field" [(ngModel)] = "usernameOrEmail" (ngModelChange)="onUsernameEmailInputChange($event)" placeholder="@Username or email address">
        </div>

        <div class="user-items" *ngIf="userToTransferTo">
          <div class="item" (click)="goToTransferUserPage(false)">
            <div class="img-wrapper">
              <!-- <img src="" alt=""> -->
              <div class="default-img">AU</div>
            </div>
            <p class="text" >
               {{userToTransferTo.email}} <br/>
              <span>{{userToTransferTo.email}}</span>
            </p>
          </div>
        </div>

      </ion-content>
    </ng-template>
  </ion-modal>
  <!-- Transfer to User Modal -->

</ion-content>
